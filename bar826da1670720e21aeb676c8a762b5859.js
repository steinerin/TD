(function(){"use strict";if("__ftnt_bar_5846482"in window)return;window.__ftnt_bar_5846482=null;var DEBUG_FIXTURE=false;var origMargin=0,origPos="",REFRESH_AGAIN_TIME=1e3,ZINDEX_MAX=251658238,TBO_CLASS="fortinet-top-bar-offset-",TBO_FIX="original-",TB_ID="fortinet-top-bar-",MF_ID="fortinet-top-bar-menu-",menuFrame,initted=false,innerReady=false,lastTopBarHeight=33,port=8011,origPort=getOrigPort(),otherOrigin=window.location["protocol"]+"//"+window.location["hostname"],webCategoryId=null,formatURI=function(){var proto=window.location.protocol;var host=window.location.hostname;var gui_no;var data_port;var scripts=document.getElementsByTagName("script");var regex=new RegExp("(?::(\\d+))?/bar([0-9a-f]{32}).js$");var opMatch_regex=/^(?:[\w+.-]*:\/\/[^\/:]*\:(\d+))/;gui_no=0;for(var i=scripts.length;i>0;i--){var script=scripts[i-1];var match=regex.exec(script.src);var opMatch;if(match){if(origPort===null){opMatch=opMatch_regex.exec(script.src);if(opMatch){origPort=opMatch[1]}}port=match[1];gui_no=match[2];break}}TB_ID+=gui_no;MF_ID+=gui_no;return function(objectName,objectExt,appendGuiNo,getVars){if(typeof g_debug!=="undefined"){return objectName+"."+objectExt}var objects=[proto,"//",host,":",port,"/",objectName];if(appendGuiNo!==false){objects.push(gui_no)}if(objectExt!==false){objects.push("."+objectExt)}if(typeof getVars==="object"){var queryParts=[];for(var key in getVars){if(getVars.hasOwnProperty(key)){queryParts.push(key+"="+getVars[key])}}objects.push("?"+queryParts.join("&"))}return objects.join("")}}();var wport=window.location["port"];if(origPort){otherOrigin+=":"+origPort}else if(origPort===null&&wport){otherOrigin+=":"+wport}if(origPos=="static"){origPos=""}var str=function(){var strtbl={EC_NONCOMP_DISCLAIMER_EXEMPT:"FortiClient Endpoint Security Software Not Found",expired:"Expired",webfilter_quota:"Web Filter Quota",vpn:"VPN",bookmarks:"Bookmarks",user:"User Name",connection_type:"Connection",duration:"Duration",remaining:"Remaining",less_than:"Less than",none:"None",notifications:"Notifications",sign_out:"Sign Out"};return function(key){return key in strtbl?strtbl[key]:key}}();function Message(msgType,data){this.msgType=msgType;this.source=Message.source;this.data=data}Message.prototype.toString=function(){return JSON.stringify(this)};Message.READY="ready";Message.REFRESH="refresh";Message.LOG="log";Message.WIDGET="widget";Message.HIDE_MENU="hideMenu";Message.SET_MENU_STYLE="setMenuStyle";Message.CLICK="click";Message.RELOAD="reload";Message.CLOSE="close";Message.REQ_CAT="requestCategory";Message.RES_CAT="respondCategory";Message.handlers={};Message.isInner=window!=window.top;Message.getSource=function(){if(!Message.isInner){return"top"}var match=/^\?.*&?name=([^&$]*)/.exec(window.location.search);if(match){return match[1]}return"inner"};Message.source=Message.getSource();Message.handling=0;Message.post=function(msgType,data,frame){var wbar=window.__ftnt_bar_5846482,otherWindow=frame?frame.contentWindow:null;if(Message.isInner){otherWindow=window.parent}else if(!otherWindow&&wbar&&String(wbar.tagName).toLowerCase()=="iframe"){otherWindow=wbar.contentWindow}if(otherWindow){try{otherWindow.postMessage(new Message(msgType,data),otherOrigin)}catch(ex){}}};Message.on=function(msgType,handler){var h=Message.handlers[msgType]=Message.handlers[msgType]||[];h.push(handler)};Message.handle=function(event){if(event.origin==otherOrigin){try{var msg=typeof event.data=="string"?JSON.parse(event.data):event.data,data=msg.data,i,h;if(h=Message.handlers[msg.msgType]){for(i=0;i<h.length;++i){h[i](data,msg.msgType,msg.source)}}}catch(ex){}}};function extendConfig(){var config={},length=arguments.length,prop;for(var i=0;i<length;i++){var param=arguments[i];if(typeof param==="object"){for(var prop in param){if(param.hasOwnProperty(prop)){config[prop]=param[prop]}}}}return config}function getJSON(url,callback,timeout_callback){var ajax_timeout=null;if(url==""){return}var http_request=null;try{http_request=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{http_request=new ActiveXObject("Microsoft.XMLHTTP")}catch(oc){http_request=null}}if(!http_request&&typeof XMLHttpRequest!="undefined"){http_request=new XMLHttpRequest}http_request.onreadystatechange=function(){var done=4,ok=200;if(http_request.readyState==done&&http_request.status==ok){clearTimeout(ajax_timeout);handleRequest()}};http_request.open("GET",url,true);http_request.send(null);ajax_timeout=setTimeout(handleTimeout,5e3);function handleTimeout(){http_request.abort();if(timeout_callback)timeout_callback(http_request)}function handleRequest(){var text=http_request.responseText;var obj=null;obj=JSON.parse(text);if(obj){callback(obj)}}}if(typeof XMLHttpRequest=="undefined"){XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}throw new Error("This browser does not support XMLHttpRequest.")}}function convert_time(time){var q=[],p=2,v;while(p>=0){v=Math.floor(time/Math.pow(60,p));time-=v*Math.pow(60,p);var pre=v<10?"0":"";q.push(pre+v);p--}return q[0]+":"+q[1]+":"+q[2]}var convert_bytes=function(units){return function(bytes){if(bytes<=0){return str("none")}var mag=Math.floor(Math.log(bytes,2));var ord=Math.round(mag/10);mag=ord*10;if(mag<20){return str("less_than")+" 1 MB"}return(bytes/Math.pow(2,mag)).toFixed(1)+" "+units[ord]}}(["B","KB","MB","GB","TB"]);function convert_quota(type,value){if(type==="traffic"){return convert_bytes(value)}else{return convert_time(value)}}function RegExpQuote(str){return(str+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function getStyle(elem,name,_computed){return elem.style[name]||curCSS(elem,name,_computed)}function getStyleLength(elem,name,_computed){return parseInt(getStyle(elem,name),10)||0}var curCSS,getStyles,rmargin=/^margin/,core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i");if(window.getComputedStyle){getStyles=function(elem){return window.getComputedStyle(elem,null)};curCSS=function(elem,name,_computed){var width,minWidth,maxWidth,computed=_computed||getStyles(elem),ret=computed?computed.getPropertyValue(name)||computed[name]:undefined,style=elem.style;if(computed){if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret}}else if(document.documentElement.currentStyle){getStyles=function(elem){return elem.currentStyle};curCSS=function(elem,name,_computed){var left,rs,rsLeft,rposition=/^(top|right|bottom|left)$/,computed=_computed||getStyles(elem),ret=computed?computed[name]:undefined,style=elem.style;if(ret==null&&style&&style[name]){ret=style[name]}if(rnumnonpx.test(ret)&&!rposition.test(name)){left=style.left;rs=elem.runtimeStyle;rsLeft=rs&&rs.left;if(rsLeft){rs.left=elem.currentStyle.left}style.left=name==="fontSize"?"1em":ret;ret=style.pixelLeft+"px";style.left=left;if(rsLeft){rs.left=rsLeft}}return ret===""?"auto":ret}}function getWebCategoryId(){var stag=document.querySelector("#ftnt_topbar_script");if(stag&&stag.className!==""){return Number(stag.className)}return null}function getOrigPort(){var match=/^\?.*&?origPort=([^&$]*)/.exec(window.location.search);return match&&match[1]}function on(target,events){for(var i in events){if(events.hasOwnProperty(i)){if("addEventListener"in target){target.addEventListener(i,events[i])}else if("attachEvent"in target){target.attachEvent("on"+i,events[i])}}}}function WidgetContainer(configParameters){if(typeof WidgetContainer.nextIndex==="undefined"){WidgetContainer.nextIndex=0}this.config=extendConfig({prefix:"__fgtbar",mode:"full",updateInterval:1e3},configParameters);this.modules=[];this.ajax_lock=false;this.dom=document.createElement("div");this.dom.id=this.config.prefix+"_container_"+WidgetContainer.nextIndex;this.bar=document.createElement("div");this.bar.id=this.config.prefix+"_bar_"+WidgetContainer.nextIndex;this.close_btn=document.createElement("div");this.close_btn.className="close_button";this.bar.style.backgroundImage="url("+formatURI("sprites","png")+")";this.close_btn.style.backgroundImage=this.bar.style.backgroundImage;var container=this;this.close_btn.onclick=function(){Message.post(Message.CLOSE)};this.bar.appendChild(this.close_btn);this.dom.appendChild(this.bar);WidgetContainer.nextIndex++;this.setHeight=function(){WidgetContainer.prototype.setHeight.call(container)}}WidgetContainer.prototype.forEachModule=function(callback){for(var i=0;i<this.modules.length;i++){callback(this.modules[i])}};WidgetContainer.prototype.addModule=function(module){this.modules.push(module)};WidgetContainer.prototype.setHeight=function(){if(this.dom.offsetHeight>0){Message.post(Message.REFRESH,this.dom.offsetHeight);if(!this.setHeight.resizeHandled){this.setHeight.resizeHandled=true;on(window,{resize:this.setHeight})}}else if(this.setHeight.count<100){++this.setHeight.count;window.setTimeout(this.setHeight,10)}};WidgetContainer.prototype.render=function(parent_node,mode){var container=this,resizeHandled=false;this.setHeight.count=0;if(typeof mode==="undefined"){mode=this.config["mode"]}this.forEachModule(function(module){module.render(container.bar,mode)});parent_node.appendChild(this.dom);this.setHeight()};WidgetContainer.prototype.update=function(){this.forEachModule(function(module){this.modules[module].update()})};WidgetContainer.prototype.triggerUpdateRequest=function(){var updateRequest={};this.forEachModule(function(module){module.processRequest(updateRequest)});this.sendUpdateRequest(updateRequest,this.handleUpdateResponse)};WidgetContainer.prototype.sendUpdateRequest=function(updateRequest,callback){var url=formatURI("data","json",false,webCategoryId!==null?{web_category_id:webCategoryId}:undefined);var container=this,require_ajax=false,module;for(module in updateRequest){if(updateRequest.hasOwnProperty(module)&&updateRequest[module].require_ajax){require_ajax=true}}if(require_ajax){if(container.ajax_lock===true){return}getJSON(url,function(response){container.ajax_lock=false;if(typeof callback==="function"){callback.apply(container,[updateRequest,response])}})}else{callback.apply(this,[{},{}])}};WidgetContainer.prototype.handleUpdateResponse=function(updateRequest,updateResponse){if(DEBUG_FIXTURE){DEBUG_FIXTURE.extend(updateResponse)}this.forEachModule(function(module){if(module.id in updateRequest){module.processResponse(updateResponse)}});setTimeout(this.setHeight,10)};WidgetContainer.prototype.mainLoop=function(){var container=this;this.interval=window.setInterval(function(){container.triggerUpdateRequest()},this.config["updateInterval"]);container.triggerUpdateRequest()};function WidgetObject(){}(function(){var ready=false;WidgetObject.extend=function(name,widget){function bindSuper(name,fn){return function(){var ret,tmp=this._super;this._super=_super[name];ret=fn.apply(this,arguments);this._super=tmp;return ret}}var _super=this.prototype;ready=false;var prototype=new this;ready=true;for(var prop in widget){if(widget.hasOwnProperty(prop)){prototype[prop]=typeof widget[prop]==="function"?bindSuper(prop,widget[prop]):widget[prop]}}function Widget(){this.widgetClass=name;if(ready===true&&typeof this.init==="function"){this.init.apply(this,arguments)}}Widget.prototype=prototype;Widget.prototype.constructor=Widget;Widget.extend=WidgetObject.extend;return Widget}})();WidgetObject.fromMessage=function(message,msgType,source){if(!Message.isInner){if(source=="inner"){menuFrame.style.cssText+=";display:block;width:100%;";Message.post(msgType,message,menuFrame)}else if(source=="menu"){Message.post(message,msgType,window.__ftnt_bar_5846482)}}var widget=new MessageWidgets[message.widgetClass](message,true);if(Message.isInner){while(document.body.firstChild){document.body.removeChild(document.body.lastChild)}document.body.appendChild(widget.dom)}if(message.action){widget[message.action]()}};WidgetObject.hideMenu=function(){menuFrame.style.display="none"};WidgetObject.setMenuStyle=function(style){menuFrame.style.cssText+=";"+style+";"};WidgetObject.click=function(i,msgType){if(Message.source=="top"){Message.post(msgType,i);WidgetObject.hideMenu()}else{var fn=WidgetObject.clickEvents[i];if(fn){fn()}}};WidgetObject.clickEvents=[];var Widgets={};var widget_index=0;var WidgetButton=WidgetObject.extend("WidgetButton",{base_config:{imageClass:"",onClick:false},init:function(parameters){this.config=extendConfig({},this.base_config,this.default_config,parameters)},render:function(parentNode){var button=this;if(this.dom){this.dom.parentNode.removeChild(this.dom)}this.dom=document.createElement("div");this.dom.style.backgroundImage="url("+formatURI("sprites","png")+")";this.dom.className="widget_button_container";this.img=document.createElement("div");this.img.style.backgroundImage="url("+formatURI("sprites","png")+")";this.img.className="widget_button_image "+this.config["imageClass"];this.count=document.createElement("div");this.count.className="widget_button_count";this.count.style["display"]="none";this.dom.appendChild(this.count);this.dom.appendChild(this.img);parentNode.appendChild(this.dom);if(typeof this.config["onClick"]==="function"){this.dom.onclick=function(){return button.config["onClick"](button)}}},showCount:function(count){this.count.innerHTML=count;this.count.style["display"]=count>1?"":"none"}});var active_menu=null;var WidgetMenu=WidgetObject.extend("WidgetMenu",{base_config:{},init:function(parameters,fromMessage){var message;if(fromMessage){message=parameters;parameters=message.config;parameters.fromMessage=true}this.config=extendConfig({},this.base_config,this.default_config,parameters);this.show=fromMessage;if(fromMessage){this.fromMessage(message)}},render:function(parentNode){if(this.dom&&this.dom.parentNode){this.dom.parentNode.removeChild(this.dom)}this.dom=document.createElement("ul");this.dom.className="widget_menu";this.dom.style["display"]="none";parentNode.appendChild(this.dom)},showMenu:function(offsetLeft){var menu=this;var skip=1;if(active_menu!==null){active_menu.hideMenu()}if(this.beforeMenuShow(this.dom)){active_menu=this;this.old_onclick=document.onclick;if(Message.source!="menu"){if(Message.source=="inner"){var dcw=this.dom.clientWidth;var pcw=this.dom.parentNode.clientWidth;if(offsetLeft+dcw>pcw){offsetLeft=pcw-dcw-2}Message.post(Message.WIDGET,this.toMessage("showMenu"));Message.post(Message.SET_MENU_STYLE,"margin-left: "+offsetLeft+"px")}setTimeout(function(){document.onclick=function(mouseEvent){if(Message.source=="inner"){Message.post(Message.HIDEMENU)}else{WidgetObject.hideMenu()}menu.hideMenu()}},10);return}else{this.dom.style.display="";var style=getStyles(this.dom);var mw=getStyleLength(this.dom,"marginLeft",style)+getStyleLength(this.dom,"marginRight",style);var mh=getStyleLength(this.dom,"marginTop",style)+getStyleLength(this.dom,"marginBottom",style);Message.post(Message.SET_MENU_STYLE,"width:"+(this.dom.offsetWidth+mw)+"px;"+"height:"+(this.dom.offsetHeight+mh)+"px;")}document.onclick=function(mouseEvent){var target=this.activeElement;if(mouseEvent){target=mouseEvent.target}if(skip>0){skip--;return true}while(target!==document){if(target===menu.dom){return true}target=target.parentNode}menu.hideMenu()}}},hideMenu:function(){this.dom.style["display"]="none";document.onclick=this.old_onclick;active_menu=null;WidgetObject.clickEvents=[]},beforeMenuShow:function(){return true},fromMessage:function(message,parent_node){function makeDom(obj){var result,i;switch(obj.nodeType){case 1:result=document.createElement(obj.tagName);break;case 3:result=document.createTextNode(obj.nodeValue);break}domPropCopy.copy(obj,result);if("onclick"in obj){result.onclick=function(){Message.post(Message.CLICK,obj.onclick)}}if(obj.cssText){result.style.cssText=obj.cssText}if(obj.children){for(i=0;i<obj.children.length;++i){result.appendChild(makeDom(obj.children[i]))}}if(obj.attributes){for(i in obj.attributes){if(obj.hasOwnProperty(i)){result.setAttribute(i,obj.attributes[i])}}}return result}function fromSerializable(src,dest){var prop,member;dest=dest||{};for(prop in src){if(src.hasOwnProperty(prop)){member=src[prop];if(typeof member=="object"&&member){if(!member.nodeType){dest[prop]=fromSerializable(member)}else{dest[prop]=makeDom(member)}}else{dest[prop]=member}}}return dest}fromSerializable(message,this)},toMessage:function(action){function domSerialize(dom){var result={},i,children=dom.childNodes,attributes=dom.attributes,attr,prop;domPropCopy.copy(dom,result);if(dom.onclick){result.onclick=WidgetObject.clickEvents.length;WidgetObject.clickEvents.push(dom.onclick)}if(dom.style){result.cssText=dom.style.cssText}if(children&&children.length>0){result.children=[];for(i=0;i<children.length;++i){result.children.push(domSerialize(children[i]))}}if(attributes&&attributes.length>0){result.attributes={};attr=attributes[0];result.attributes[attr.name]=attr.value}return result}function serializable(obj){var result={};for(var prop in obj){var member=obj[prop];switch(typeof member){case"object":if(!member){result[prop]=member}else{if(!member.nodeType){result[prop]=serializable(member)}else{result[prop]=domSerialize(member)}}break;case"function":break;default:result[prop]=member}}return result}var result=serializable(this);result.action=action;return result}});WidgetMenu.show=function(widget){};var BaseWidget=WidgetObject.extend("BaseWidget",{base_config:{updateInterval:false,widgetType:"basic",showItemCount:false,haveMenu:false,haveExtra:false,button:{},menu:{}},init:function(parameters){this.config=extendConfig({},this.base_config,this.default_config,parameters);this.last_update=null;this.id=this.config["widgetType"]+"_"+widget_index++;this.require_ajax=false;this.config.button["onClick"]=this.genShowMenu();this.button=new WidgetButton(this.config.button);this.menu=new WidgetMenu(this.config.menu)},processRequest:function(updateRequest){var next_update=0;if(this.config["updateInterval"]===false){return}if(this.last_update!==null){next_update=this.last_update.getTime()+this.config["updateInterval"]-(new Date).getTime()}if(next_update<=0){updateRequest[this.id]=this}},processResponse:function(updateResponse){this.last_update=new Date},render:function(parentNode,mode){var that=this;this.config["mode"]=mode;if(this.dom){this.dom.parentNode.removeChild(this.dom)}this.dom=document.createElement("div");this.dom.className="widget "+this.config["widgetType"]+"_widget";this.button.render(this.dom,mode);if(mode!=="collapsed"&&this.config["haveExtra"]){this.extra=document.createElement("div");this.extra.className="widget_info";this.dom.appendChild(this.extra)}parentNode.appendChild(this.dom);if(this.config["haveMenu"]){this.menu.render(parentNode.parentNode,mode)}if(this.config["clickable"]){on(this.dom,{click:function(){that.menu.showMenu(that.button.dom.offsetLeft)}})}},toggle:function(showhide){this.dom["style"]["display"]=showhide?"":"none"},genShowMenu:function(){var that=this;return function(button){if(that.config["haveMenu"]){var menu=that.menu;that.menu.showMenu(button.dom.offsetLeft)}}}});Widgets["ImageWidget"]=BaseWidget.extend("ImageWidget",{default_config:{widgetType:"image",imageSource:"",collapsedSource:false},render:function(parentNode,mode){if(this.dom){this.dom.parentNode.removeChild(this.dom)}this.dom=document.createElement("div");this.dom.className="widget image_widget";var img=document.createElement("div");img.style.backgroundImage="url("+formatURI("sprites","png")+")";if(mode==="collapsed"&&this.config["collapsedSource"]){img.className="image_widget_image "+this.config["collapsedSource"]}else{img.className="image_widget_image "+this.config["imageSource"]}this.dom.appendChild(img);parentNode.appendChild(this.dom)}});function AppCtrlNotice(info){this.icon="warn";this.message=info["appname"]+" "+str("Application Was Blocked")}function EndpointNotice(info){this.icon="error";this.message=str(info["status"])}Widgets["NotifyWidget"]=BaseWidget.extend("NotifyWidget",{default_config:{updateInterval:5e3,widgetType:"notify",haveMenu:true,haveExtra:true,button:{imageClass:"notify_button"},clickable:true},init:function(parameters){this._super(parameters);this.require_ajax=true;this.notifications=[];this.menu.beforeMenuShow=function(that){return function(menu){menu.innerHTML="";var item=document.createElement("li");item.innerHTML=str("notifications");item.className="heading";menu.appendChild(item);for(var i=0;i<that.notifications.length;i++){var li=document.createElement("li");li.className="notify_message";li.innerHTML=that.notifications[i].message;menu.appendChild(li)}return that.notifications.length>0}}(this)},render:function(parentNode,mode){this._super(parentNode,mode);this.update();return true},update:function(){var mode=this.config["mode"];this.toggle(this.notifications.length>0);this.button.showCount(this.notifications.length);this.extra.innerHTML="";if(this.notifications.length>0){var top_notice=this.notifications[0];var notice=document.createElement("div");notice.className="extra_info_notice";notice.innerHTML=top_notice.message;this.extra.appendChild(notice)}},processResponse:function(updateResponse){this._super(updateResponse);this.notifications=[];if("appsrc"in updateResponse){for(var i=0;i<updateResponse["appsrc"].length;i++){if(updateResponse["appsrc"][i]["app"]===0){continue}this.notifications.push(new AppCtrlNotice(updateResponse["appsrc"][i]))}}if("ec"in updateResponse){if(updateResponse["ec"]["status"]!=="EC_COMPLIANT"){this.notifications.push(new EndpointNotice(updateResponse["ec"]))}}this.update()}});Widgets["WebfilterQuotaWidget"]=BaseWidget.extend("WebfilterQuotaWidget",{default_config:{updateInterval:1e4,widgetType:"quota",haveExtra:true},init:function(parameters){this._super(parameters);this.require_ajax=true;this.quota_remaining=0;this.interval=null;this.quota_index=null;this.active=false},render:function(parentNode,mode){this._super(parentNode,mode);var widget=this;if(this.interval===null){var widget=this;this.interval=window.setInterval(function(){if(widget.quota_remaining&&widget.active){widget.quota_remaining--;widget.update()}},1e3)}this.update();return true},update:function(){var mode=this.config["mode"],info={heading:str("webfilter_quota"),remaining:str("remaining")+": "+convert_quota(this.quota_type,this.quota_remaining)},key;this.extra.innerHTML="";for(key in info){var elem=document.createElement("div");elem.className="extra_info_"+key;elem.innerHTML=info[key];this.extra.appendChild(elem)}this.toggle(this.quota_index!==null)},processResponse:function(updateResponse){this._super(updateResponse);if("quota"in updateResponse){var cur=-1;var cnt=updateResponse["quota"]["cnt"];for(var iter=0;iter<cnt;iter++){if(updateResponse["quota"]["quotas"][iter].active===1){cur=iter}}if(this.quota_index===null){if(cur!==-1){this.quota_index=cur}}if(this.quota_index!==null){this.quota_type=updateResponse.quota.quotas[this.quota_index].type;this.quota_remaining=updateResponse.quota.quotas[this.quota_index].remaining}this.active=cur!==-1}this.update()}});function handleLogout(result){if("logout_success"in result&&result["logout_success"]==true){if(!Message.isInner){window.location.reload()}else{Message.post(Message.RELOAD)}}}Widgets["UserWidget"]=BaseWidget.extend("UserWidget",{default_config:{updateInterval:1e4,widgetType:"user",haveExtra:true,haveMenu:true,button:{imageClass:"user_button"},clickable:true},init:function(parameters){this._super(parameters);this.require_ajax=true;this.info={};this.token=false;var widget=this;this.menu.beforeMenuShow=function(that){return function(menu){menu.innerHTML="";var item=document.createElement("li");var link=document.createElement("a");link.href="#";link.innerHTML=str("sign_out");item.onclick=function(){var url=formatURI("logout",false,false,{token:widget.token});getJSON(url,handleLogout,function(){handleLogout({logout_success:true})});return false};item.className="menu_item";item.appendChild(link);menu.appendChild(item);return widget.token!==false}}(this)},render:function(parentNode,mode){this._super(parentNode,mode);this.update()},update:function(){var mode=this.config["mode"],key;this.extra.innerHTML="";for(key in this.info){var elem=document.createElement("div");elem.className="extra_info_"+key;elem.innerHTML=this.info[key];this.extra.appendChild(elem)}this.toggle(this.user!==null&&this.user!=="")},processResponse:function(updateResponse){this._super(updateResponse);this.info={};this.user=null;if("policy"in updateResponse){var user=updateResponse["policy"]["user"];if(user!==""){this.info["heading"]=user}this.user=user;if("token"in updateResponse["policy"]){this.token=updateResponse["policy"]["token"]}}if("ipsec"in updateResponse&&updateResponse["ipsec"].length>0){var tunnel=updateResponse["ipsec"][0];this.user="ipsec";this.token=false;this.info["heading"]="VPN";if("name"in tunnel){this.info["heading"]+=" ("+tunnel["name"]+")"}if("user"in tunnel&&tunnel["user"]!==""){this.user=tunnel["user"];this.info["heading"]+=": "+this.user}if("uptime"in tunnel){this.info["duration"]=str("duration")+": "+convert_time(tunnel["uptime"])}}if("sslvpn"in updateResponse){if("user"in updateResponse["sslvpn"]){this.info["heading"]="SSL-VPN ("+updateResponse["sslvpn"]["user"]+")"}if("uptime"in updateResponse["sslvpn"]){this.info["duration"]=str("duration")+": "+convert_time(updateResponse["sslvpn"]["uptime"])}this.user=updateResponse["sslvpn"]["user"];this.token=false}this.update()}});function parseURL(url){var spec={};var re=new RegExp("^((https?)://)?(.+)");var match=re.exec(url);spec["protocol"]=match&&match[2]?match[2]:"http";spec["path"]=match&&match[3]?match[3]:url;return spec}var proxySchemas={default:{window_options:{width:800,height:600,resizable:"yes",scrollbars:"yes"}},web:{getPath:function(bookmark){var info=parseURL(bookmark.url);return"proxy/"+fgt_sslvpn_sid+"/"+info["protocol"]+"/"+info["path"]},window_options:{toolbar:"yes",location:"yes"}}};function buildBookmarkLink(bookmark,host,item){var link=null;if(bookmark&&bookmark["apptype"]in proxySchemas){var schema=proxySchemas[bookmark["apptype"]];var uri="";if(host){uri=fgt_sslvpn_transform_url_path(bookmark.url,false,"web")}else{var info=parseURL(bookmark.url);uri=info["protocol"]+"://"+info["path"]}var options=extendConfig({},proxySchemas["default"]["window_options"],schema["window_options"]);var comp=[];for(var opt in options){if(options.hasOwnProperty(opt)){comp.push(opt+"="+options[opt])}}link=document.createElement("a");link.href="#";link.innerHTML=bookmark.name;item.onclick=getBookmarkOnClick(uri,comp.join(","))}return link}function getBookmarkOnClick(uri,spec){return function(){var nwin;if(typeof window.Portal=="undefined"){window.Portal=true}nwin=window.open(uri,"",spec);try{nwin.opener=null}catch(e){}}}Widgets["BookmarkWidget"]=BaseWidget.extend("BookmarkWidget",{default_config:{updateInterval:1e4,widgetType:"bookmark",haveMenu:true,button:{imageClass:"bookmark_button"}},init:function(parameters){this._super(parameters);this.require_ajax=true;this.bookmarks=[];this.menu.beforeMenuShow=function(that){return function(menu){menu.innerHTML="";if(that.bookmarks.length<1){return false}var item=document.createElement("li");item.innerHTML=str("bookmarks");item.className="heading";menu.appendChild(item);for(var i=0;i<that.bookmarks.length;i++){var bookmark=that.bookmarks[i];var item=document.createElement("li");var link=buildBookmarkLink(bookmark,that.portal_host,item);if(link){item.className="menu_item";item.appendChild(link);menu.appendChild(item)}}return that.bookmarks.length>0}}(this)},render:function(parentNode,mode){this._super(parentNode,mode);this.update()},update:function(){var mode=this.config["mode"];this.toggle(this.bookmarks.length>0)},processResponse:function(updateResponse){this._super(updateResponse);this.bookmarks=[];if("sslvpn"in updateResponse){for(var type in{bookmark_admin:true,bookmark_user:true}){if(type in updateResponse["sslvpn"]){for(var category in updateResponse["sslvpn"][type]){var bookmarks=updateResponse["sslvpn"][type][category];for(var i=0;i<bookmarks.length;i++){this.bookmarks.push(bookmarks[i])}}}}this.portal_host=null;if(updateResponse["sslvpn"]["portal_host"])this.portal_host=updateResponse["sslvpn"]["portal_host"]}this.update()}});var domPropCopy={nodeValue:false,className:false,nodeType:true,tagName:true};domPropCopy.copy=function(src,dest){var i,value;for(i in this){if(this.hasOwnProperty(i)&&typeof this[i]!="function"){value=src[i];if(value&&(!this[i]||!(i in dest))){dest[i]=value}}}};var MessageWidgets={WidgetMenu:WidgetMenu};var widgetConfig=[{type:"ImageWidget",config:{imageSource:"fortinet_logo",collapsedSource:"fortinet_ico"}},{type:"NotifyWidget"},{type:"WebfilterQuotaWidget"},{type:"UserWidget"},{type:"BookmarkWidget"}];function isBrowserSupported(){return"JSON"in window&&JSON.parse&&JSON.stringify&&"postMessage"in window}function log(){var args=Array.prototype.slice.call(arguments);if(Message.isInner){args.unshift("Log from "+Message.source+":");Message.post(Message.LOG,args)}else if("apply"in console.log){console.log.apply(console,args)}else{console.log(JSON.stringify(args))}}function setData(elem,key,value){elem.setAttribute("data-"+TBO_CLASS+"-"+key,value)}function getData(elem,key,fmt){var data=elem.getAttribute("data-"+TBO_CLASS+"-"+key);if(data=="null"){return null}if(fmt&&data){data=fmt(data)}return data}function cssCase(prop){return prop.replace(/[A-Z]/g,function(c){return"-"+c.toLowerCase()})}function refresh(topBarHeight){function fixElem(elem,property,value,fixProp,styles){fixProp=fixProp||property;var TBO_FIX_CLASS=TBO_FIX+property,classEx=TBO_CLASS_EX[property]=TBO_CLASS_EX[property]||new RegExp("\\s?\\b"+TBO_FIX+property+"\\b","g"),key=TBO_FIX+fixProp,eValue,style;if(typeof value=="number"){style=getStyleLength(elem,property,styles)}else{style=getStyle(elem,property,styles)}if(style==value&&topBarHeight>0){eValue=getData(elem,key,Number);if(eValue===null){eValue=getStyleLength(elem,fixProp)}elem.style.cssText+=";"+cssCase(fixProp)+":"+(eValue+topBarHeight)+"px !important;";setData(elem,key,eValue);if(!classEx.test(elem.className)){elem.className+=" "+TBO_FIX_CLASS}return true}else if(classEx.test(elem.className)){eValue=getData(elem,key);if(Number(eValue)){eValue+="px"}elem.style[fixProp]=eValue;elem.className=elem.className.replace(classEx,"")}return false}var html=document.documentElement,marginKey=TBO_FIX+"marginTop",topMargin=getData(html,marginKey,Number),topBar=document.getElementById(TB_ID),elems=document.body.getElementsByTagName("*"),eTopMargin,i,styles=getStyles(html),TBO_CLASS_EX={},start=refresh.abort_index||0,start_time,MAX_FIX_MS=50;if(typeof topBarHeight=="undefined"){topBarHeight=lastTopBarHeight}lastTopBarHeight=topBarHeight;if(topMargin===null){topMargin=getStyleLength(html,"marginTop");setData(html,marginKey,topMargin)}html.style.cssText+=";margin-top: "+(topMargin+topBarHeight)+"px !important;";if(topBarHeight==0){html.style.position=origPos}else{html.style.position=origPos||"relative"}if(topBar){topBar.style.height=topBarHeight+"px"}if(menuFrame){menuFrame.style.marginTop=topBarHeight+2+"px"}fixElem(html,"backgroundAttachment","fixed","backgroundPositionY",styles);start_time=(new Date).getTime();for(i=start;i<elems.length;++i){var e=elems[i];if(e.id!=TB_ID&&e.id!=MF_ID){styles=getStyles(e);fixElem(e,"position","fixed","marginTop",styles);fixElem(e,"backgroundAttachment","fixed","backgroundPositionY",styles);if((new Date).getTime()-start_time>MAX_FIX_MS){refresh.abort_index=i+1;return}}}refresh.abort_index=0}function refresh_timeout(){refresh()}function resize(){refresh();setTimeout(refresh_timeout,REFRESH_AGAIN_TIME)}function createBar(){if(!isBrowserSupported()){return null}var bar=document.getElementById(TB_ID);if(!bar){bar=document.createElement("iframe");origMargin=document.body.style.marginTop;origPos=document.body.style.position;bar.src=formatURI("fortibar","html",true,{origPort:window.location.port});bar.scrolling="no";bar.frameBorder="0";bar.setAttribute("seamless","seamless");document.body.appendChild(bar)}bar.style.display="none";bar.id=TB_ID;bar.style.cssText="position: fixed; top: 0; left: 0; width: 100%;"+" height: 0px; z-index: "+ZINDEX_MAX+";"+" overflow: hidden; border: 0 none; padding: 0;"+" margin: 0;";refresh();return bar}function close(){var bar=window.__ftnt_bar_5846482;if(!Message.isInner&&menuFrame&&bar){if(menuFrame.parentNode){menuFrame.parentNode.removeChild(menuFrame)}if(bar.parentNode){bar.parentNode.removeChild(bar)}refresh(0)}}function init(eo){function setupIFrame(iframe){iframe.style.cssText="width:0;height:0;overflow:hidden;"+";overflow:hidden; border: 0 none;"+"padding: 0; margin: 0;";iframe.scrolling="no";iframe.frameBorder="0"}if(initted){return}initted=true;function addCSS(){var head=document.getElementsByTagName("head")[0];var css=document.createElement("link");css.rel="stylesheet";css.type="text/css";css.href=formatURI("cstyle","css");head.appendChild(css)}if(window.__ftnt_bar_5846482===null&&(document.readyState=="complete"||document.readyState=="interactive")){if(Message.source=="inner"){var bar=new WidgetContainer;for(var i=0;i<widgetConfig.length;i++){var widget=widgetConfig[i];bar.addModule(new Widgets[widget.type](widget.config))}addCSS();window.__ftnt_bar_5846482=bar;Message.post(Message.READY)}else if(Message.source=="menu"){addCSS();document.body.className="menu-frame"}else if(!Message.isInner&&isBrowserSupported()){var fixCollapse=document.createElement("div");fixCollapse.style.cssText="width:0 !important;height:0 !important;"+"overflow:hidden !important;"+"visibility: hidden !important;"+"padding:0 !important;"+"border:0 !important;margin:0 !important;";window.__ftnt_bar_5846482=createBar();menuFrame=document.createElement("iframe");setupIFrame(menuFrame);menuFrame.style.cssText+=";position:fixed;top:0;left:0;"+"z-index:"+ZINDEX_MAX+";display: none;";menuFrame.id=MF_ID;menuFrame.src=formatURI("fortibar","html",true,{name:"menu",origPort:window.location.port});document.body.appendChild(menuFrame);document.body.insertBefore(fixCollapse,document.body.firstChild);on(window,{resize:resize});if(innerReady){Message.post(Message.READY)}}}}function innerInit(){if(Message.isInner){var bar=window.__ftnt_bar_5846482;bar.render(document.body);bar.mainLoop()}else{innerReady=true;if(window.__ftnt_bar_5846482){Message.post(Message.READY)}else{setTimeout(init,100)}}}function requestCategory(){var catId=getWebCategoryId();if(catId!==null){Message.post(Message.RES_CAT,catId)}}function respondCategory(catId){webCategoryId=catId}function body_load(){body_load.count=(body_load.count||0)+1;if(document.body){on(document.body,{load:init})}else if(body_load.count<1e3){setTimeout(body_load,1)}}if(window==window.top&&isBrowserSupported()){setTimeout(createBar,10)}else{Message.post(Message.REQ_CAT)}Message.on(Message.LOG,log);Message.on(Message.REFRESH,refresh);Message.on(Message.WIDGET,WidgetObject.fromMessage);Message.on(Message.HIDE_MENU,WidgetObject.hideMenu);Message.on(Message.SET_MENU_STYLE,WidgetObject.setMenuStyle);Message.on(Message.CLICK,WidgetObject.click);Message.on(Message.RELOAD,function(){window.location.reload()});Message.on(Message.CLOSE,close);Message.on(Message.READY,innerInit);Message.on(Message.REQ_CAT,requestCategory);Message.on(Message.RES_CAT,respondCategory);on(document,{readystatechange:init,load:init});if(document.body){on(document.body,{load:init})}on(window,{message:Message.handle});if(document.readyState=="complete"){init()}})();